<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Oliver Turns 8 ‚Äì RSVP</title>

  <style>
    :root{
      --gold:#ffd36b;
      --blue:#00aaff;
      --red:#ff3c3c;
      --bg1:#173a66;
      --bg2:#04060a;

      /* CRAWL DURATION (1 min 23 sec) */
      --crawl-ms: 83000ms;
    }

    html, body { height: 100%; }
    body{
      margin:0;
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      color:#fff;
      background: radial-gradient(circle at 30% 10%, var(--bg1), var(--bg2) 60%, #000);
      overflow:hidden;
    }

    /* ===== FX CANVASES ===== */
    #starfield, #confetti{
      position:fixed;
      inset:0;
      width:100vw;
      height:100vh;
      pointer-events:none;
    }
    #starfield{ z-index: 1; }
    #confetti{ z-index: 9998; }

    /* ===== START OVERLAY (audio unlock) ===== */
    #startOverlay{
      position:fixed;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      z-index: 9999;
      background: radial-gradient(circle at 50% 30%, rgba(15,40,70,.92), rgba(0,0,0,.92));
      backdrop-filter: blur(6px);
      text-align:center;
      padding: 24px;
    }
    .startCard{
      width:min(680px, 92vw);
      border:1px solid rgba(255,255,255,.18);
      background: rgba(0,0,0,.55);
      box-shadow: 0 20px 60px rgba(0,0,0,.55);
      border-radius: 18px;
      padding: 20px 18px;
    }
    .startTitle{
      font-weight:900;
      letter-spacing:2px;
      font-size: clamp(22px, 5vw, 34px);
      margin-bottom: 8px;
    }
    .startSub{
      opacity:.85;
      font-size: clamp(12px, 3.2vw, 16px);
      margin-bottom: 14px;
      line-height:1.35;
    }
    .startBtn{
      width: 100%;
      border:none;
      cursor:pointer;
      padding: 14px 16px;
      border-radius: 14px;
      font-weight: 900;
      font-size: 16px;
      letter-spacing: .6px;
      background: linear-gradient(180deg,#ffe7a6,var(--gold));
      color:#1a1200;
    }

    /* ===== GOLD CRAWL SCREEN ===== */
    #crawlScreen{
      position:fixed;
      inset:0;
      z-index: 50;
      display:none; /* shown after Start */
      align-items:center;
      justify-content:center;
      overflow:hidden;
      background: rgba(0,0,0,.0);
    }

    .crawlWrap{
      position:relative;
      width: min(900px, 92vw);
      height: 100vh;
      perspective: 420px;
      transform-style: preserve-3d;
      pointer-events:none;
    }

    .crawlTitle{
      position:absolute;
      top: 8vh;
      left:50%;
      transform: translateX(-50%);
      text-align:center;
      letter-spacing: 2px;
      font-weight: 900;
      color: rgba(210,240,255,.9);
      text-shadow: 0 0 18px rgba(255,255,255,.18);
      opacity: .95;
      font-size: clamp(14px, 3.8vw, 22px);
      pointer-events:none;
    }

    .crawl{
      position:absolute;
      bottom:-120%;
      left: 50%;
      transform: translateX(-50%) rotateX(24deg);
      transform-origin: 50% 100%;
      width: min(720px, 92vw);
      color: var(--gold);
      font-weight: 800;
      letter-spacing: .8px;
      text-align: justify;
      line-height: 1.55;
      font-size: clamp(14px, 2.6vw, 22px);
      text-shadow: 0 0 20px rgba(255,211,107,.18);
      opacity: .95;
    }

    .crawl.run{
      animation: crawlUp var(--crawl-ms) linear forwards;
    }

    @keyframes crawlUp{
      0%{
        transform: translateX(-50%) rotateX(24deg) translateY(0);
        opacity: 1;
      }
      95%{ opacity: 1; }
      100%{
        transform: translateX(-50%) rotateX(24deg) translateY(-300%);
        opacity: 0;
      }
    }

    /* ===== MAIN CARD UI ===== */
    #mainCard{
      position: fixed;
      inset:0;
      display:none; /* shown after crawl */
      align-items:center;
      justify-content:center;
      padding:24px;
      z-index: 5;
    }

    .card{
      width:min(720px,100%);
      border:1px solid rgba(255,255,255,.18);
      background:rgba(0,0,0,.55);
      box-shadow:0 20px 60px rgba(0,0,0,.45);
      border-radius:18px;
      overflow:hidden;
      transform: scale(.985);
      opacity: 0;
      transition: opacity .12s ease, transform .12s ease; /* super snappy */
    }
    #mainCard.show .card{
      opacity: 1;
      transform: scale(1);
    }

    .top{ padding:26px 22px 18px; text-align:center; }
    .title{ font-weight:900; letter-spacing:3px; font-size:clamp(22px,4.6vw,36px); }
    .subtitle{ opacity:.85; margin-top:6px; font-size:clamp(12px,2.6vw,16px); letter-spacing:1px; }

    .pillrow{ display:flex; gap:10px; justify-content:center; margin-top:14px; flex-wrap:wrap; }
    .pill{
      padding:8px 12px;
      border-radius:999px;
      font-weight:800;
      font-size:12px;
      border:1px solid rgba(255,255,255,.18);
      background:rgba(255,255,255,.06);
    }
    .pill.blue{ border-color:rgba(0,170,255,.45); }
    .pill.red{ border-color:rgba(255,60,60,.45); }

    .mid{ padding:0 22px 18px; display:grid; gap:12px; }
    .row{ display:grid; grid-template-columns:1fr 1fr; gap:12px; }
    @media (max-width:520px){ .row{ grid-template-columns:1fr; } }

    .btn{
      width:100%;
      border:none;
      cursor:pointer;
      padding:14px 16px;
      border-radius:14px;
      font-weight:900;
      font-size:16px;
      letter-spacing:.5px;
    }
    .btn.gold{ background:linear-gradient(180deg,#ffe7a6,var(--gold)); color:#1a1200; }
    .btn.blue{ background:linear-gradient(180deg,#3ad0ff,var(--blue)); color:#00131a; }
    .btn.red{ background:linear-gradient(180deg,#ff7b7b,var(--red)); color:#1a0000; }

    .fine{
      opacity:.75;
      font-size:12px;
      line-height:1.35;
      text-align:center;
      padding:0 22px 22px;
    }
    a{ color:var(--gold); }

    /* ===== SECRET BDAY OVERLAY ===== */
    .secretMsg{
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      pointer-events: none;
      opacity: 0;
      transition: opacity .20s ease;
      z-index: 9999;
    }
    .secretMsg.show{ opacity: 1; }

    .secretCard{
      text-align:center;
      padding: 18px 18px;
      border-radius: 18px;
      background: rgba(0,0,0,.72);
      border: 1px solid rgba(255,255,255,.18);
      box-shadow: 0 18px 60px rgba(0,0,0,.5);
      backdrop-filter: blur(6px);
      max-width: 92vw;
    }
    .secretTitleMsg{
      font-weight: 900;
      letter-spacing: 1.2px;
      font-size: clamp(20px, 5vw, 34px);
    }
    .secretSub{
      opacity: .9;
      margin-top: 8px;
      font-size: clamp(12px, 3.2vw, 16px);
    }

    /* ===== DUEL OVERLAY (lightsabers graphic) ===== */
    #duelFx{
      position:fixed;
      inset:0;
      z-index: 9997;
      pointer-events:none;
      display:flex;
      align-items:center;
      justify-content:center;
      opacity:0;
      transition: opacity .08s ease;
    }
    #duelFx.show{ opacity: 1; }

    .duelStage{
      width: min(620px, 92vw);
      height: min(360px, 55vh);
      position: relative;
      filter: drop-shadow(0 0 22px rgba(255,255,255,.15));
    }

    .saber{
      position:absolute;
      left:50%;
      top:50%;
      width: 6px;
      height: 240px;
      border-radius: 999px;
      transform-origin: 50% 92%;
    }
    .saber:before{
      content:"";
      position:absolute;
      inset:-10px -12px;
      border-radius: 999px;
      opacity:.25;
      filter: blur(10px);
      background: currentColor;
    }
    .saber.blue{ color: rgba(0,170,255,1); background: rgba(0,170,255,.92); }
    .saber.red{ color: rgba(255,60,60,1); background: rgba(255,60,60,.92); }

    .saber.blue{ transform: translate(-50%,-50%) rotate(-22deg); }
    .saber.red{  transform: translate(-50%,-50%) rotate(22deg); }

    .spark{
      position:absolute;
      left:50%;
      top:50%;
      width: 10px;
      height: 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.95);
      transform: translate(-50%,-50%);
      box-shadow: 0 0 18px rgba(255,255,255,.7);
      opacity:0;
    }

    #duelFx.show .saber.blue{ animation: saberBlue .55s ease-in-out 1; }
    #duelFx.show .saber.red{  animation: saberRed  .55s ease-in-out 1; }
    #duelFx.show .spark{      animation: sparkPop  .55s ease-in-out 1; }

    @keyframes saberBlue{
      0%{ transform: translate(-50%,-50%) rotate(-24deg); }
      40%{ transform: translate(-50%,-50%) rotate(-8deg); }
      60%{ transform: translate(-50%,-50%) rotate(-32deg); }
      100%{ transform: translate(-50%,-50%) rotate(-22deg); }
    }
    @keyframes saberRed{
      0%{ transform: translate(-50%,-50%) rotate(24deg); }
      40%{ transform: translate(-50%,-50%) rotate(8deg); }
      60%{ transform: translate(-50%,-50%) rotate(32deg); }
      100%{ transform: translate(-50%,-50%) rotate(22deg); }
    }
    @keyframes sparkPop{
      0%{ opacity:0; transform: translate(-50%,-50%) scale(.6); }
      35%{ opacity:1; transform: translate(-50%,-50%) scale(1.4); }
      100%{ opacity:0; transform: translate(-50%,-50%) scale(2.4); }
    }

    /* ===== RSVP WARP OVERLAY + COUNTDOWN ===== */
    #warpOverlay{
      position:fixed;
      inset:0;
      z-index: 9996;
      pointer-events:none;
      opacity:0;
      transition: opacity .10s ease;
      background:
        radial-gradient(circle at 50% 45%, rgba(255,255,255,.10), rgba(0,0,0,.75) 60%),
        radial-gradient(circle at 50% 45%, rgba(0,170,255,.18), rgba(0,0,0,0) 55%);
      backdrop-filter: blur(2px);
      display:flex;
      align-items:center;
      justify-content:center;
      text-align:center;
      padding: 22px;
    }
    #warpOverlay.show{ opacity:1; }

    .warpText{
      font-weight: 900;
      letter-spacing: 1.4px;
      font-size: clamp(18px, 4.5vw, 30px);
      text-shadow: 0 0 22px rgba(255,255,255,.18);
    }
    .warpSub{
      margin-top: 10px;
      opacity:.85;
      font-weight: 800;
      font-size: clamp(12px, 3.2vw, 16px);
    }
  </style>
</head>

<body>
  <!-- FX -->
  <canvas id="starfield"></canvas>
  <canvas id="confetti"></canvas>

  <!-- Duel FX -->
  <div id="duelFx">
    <div class="duelStage">
      <div class="saber blue"></div>
      <div class="saber red"></div>
      <div class="spark"></div>
    </div>
  </div>

  <!-- RSVP warp -->
  <div id="warpOverlay">
    <div>
      <div class="warpText">HYPERJUMP INITIATED</div>
      <div class="warpSub" id="warpCountdown">Jumping in 3‚Ä¶</div>
    </div>
  </div>

  <!-- Secret Bday -->
  <div id="secretMsg" class="secretMsg">
    <div class="secretCard">
      <div class="secretTitleMsg">üéâ HAPPY BIRTHDAY, OLIVER!</div>
      <div class="secretSub">May the Force be with you on Level 8 üöÄ</div>
    </div>
  </div>

  <!-- Start Overlay -->
  <div id="startOverlay">
    <div class="startCard">
      <div class="startTitle">THE BALANCE OF EIGHT</div>
      <div class="startSub">Tap START to begin the opening crawl and music.</div>
      <button class="startBtn" id="startBtn">START</button>
    </div>
  </div>

  <!-- Crawl Screen -->
  <div id="crawlScreen">
    <div class="crawlWrap">
      <div class="crawlTitle">A BIRTHDAY STORY‚Ä¶</div>
      <div class="crawl" id="crawlText">
        <p>
          It is a time of celebration across the galaxy.
          OLIVER approaches LEVEL EIGHT, stronger, braver, and more legendary with every passing mission.
        </p>
        <p>
          Friends and allies are summoned to a hidden outpost, where laughter echoes like starfire
          and the Force feels unusually‚Ä¶ festive.
        </p>
        <p>
          Rumors speak of surprise challenges, secret rewards, and a destiny written in
          bright gold across the sky.
        </p>
        <p>
          The countdown begins. The adventure awaits.
          And the balance of eight is about to awaken‚Ä¶
        </p>
      </div>
    </div>
  </div>

  <!-- Main Menu -->
  <div id="mainCard">
    <div class="card">
      <div class="top">
        <div class="title" id="secretTitle">THE BALANCE OF EIGHT</div>
        <div class="subtitle">Tap to ignite. Then continue to RSVP.</div>
        <div class="pillrow">
          <div class="pill blue">LIGHT SIDE</div>
          <div class="pill red">DARK SIDE</div>
        </div>
      </div>

      <div class="mid">
        <button class="btn gold" id="igniteBtn">IGNITE LIGHTSABERS ‚öîÔ∏è</button>

        <div class="row">
          <button class="btn blue" id="musicBtn">PLAY THEME MUSIC üéµ</button>
          <button class="btn red" id="stopBtn">STOP MUSIC ‚õî</button>
        </div>

        <button class="btn gold" id="rsvpBtn">CONTINUE TO RSVP üìã</button>
      </div>

      <div class="fine">
        RSVP goes to Google Forms:
        <a id="formLink" target="_blank" rel="noopener">open form</a>
      </div>
    </div>
  </div>

  <script>
    // ========================= SETTINGS =========================
    const RSVP_FORM = "https://docs.google.com/forms/d/1OLrE8YDSc8s2vui9SLxuMw_eFsDtCxU6Dw6OUFzqhu0/viewform";

    // Files must exist in the repo root EXACTLY with these names:
    const INTRO_URL = "./intro.mp3";                 // your new intro music for crawl (no loop)
    const THEME_URL = "./Star Wars Theme.mp3";       // menu theme (loop)
    const SABER_URL = "./Lightsaber Fight.mp3";      // saber audio

    // Crawl duration in JS (must match CSS variable for best sync)
    const CRAWL_MS = 83000; // 1:23

    // ========================= HELPERS =========================
    function vibe(pattern){ if (navigator.vibrate) navigator.vibrate(pattern); }

    function safeAudio(url){
      const a = new Audio(url);
      a.preload = "auto";
      return a;
    }

    // ========================= AUDIO =========================
    const intro = safeAudio(INTRO_URL);
    const theme = safeAudio(THEME_URL);
    const saber = safeAudio(SABER_URL);

    intro.loop = false;
    intro.volume = 1.0;

    theme.loop = true;
    theme.volume = 0.70;

    saber.loop = false;
    saber.volume = 1.0;

    async function playFromUserTap(audio, restart=true){
      try{
        if (restart) audio.currentTime = 0;
        await audio.play();
        return true;
      } catch(e){
        return false;
      }
    }

    // ========================= DOM =========================
    const startOverlay = document.getElementById("startOverlay");
    const startBtn = document.getElementById("startBtn");

    const crawlScreen = document.getElementById("crawlScreen");
    const crawlText = document.getElementById("crawlText");

    const mainCard = document.getElementById("mainCard");
    const formLink = document.getElementById("formLink");
    formLink.href = RSVP_FORM;

    const duelFx = document.getElementById("duelFx");

    const secretTitle = document.getElementById("secretTitle");
    const secretMsg = document.getElementById("secretMsg");

    const warpOverlay = document.getElementById("warpOverlay");
    const warpCountdown = document.getElementById("warpCountdown");

    // ========================= STARFIELD (idle) =========================
    const sfCanvas = document.getElementById("starfield");
    const sfCtx = sfCanvas.getContext("2d", { alpha:true });
    let sfStars = [];
    let sfW = 0, sfH = 0;

    function sfResize(){
      const dpr = Math.max(1, window.devicePixelRatio || 1);
      sfW = window.innerWidth; sfH = window.innerHeight;
      sfCanvas.width = Math.floor(sfW * dpr);
      sfCanvas.height = Math.floor(sfH * dpr);
      sfCanvas.style.width = sfW + "px";
      sfCanvas.style.height = sfH + "px";
      sfCtx.setTransform(dpr,0,0,dpr,0,0);

      const count = Math.min(220, Math.floor((sfW * sfH) / 6500));
      sfStars = Array.from({length: count}, () => ({
        x: Math.random() * sfW,
        y: Math.random() * sfH,
        r: 0.6 + Math.random() * 1.5,
        a: 0.18 + Math.random() * 0.55,
        tw: 0.003 + Math.random() * 0.012,
        sp: 0.06 + Math.random() * 0.24
      }));
    }
    sfResize();
    window.addEventListener("resize", sfResize);

    let sfLast = performance.now();
    function sfLoop(t){
      const dt = Math.min(32, t - sfLast);
      sfLast = t;

      sfCtx.clearRect(0,0,sfW,sfH);
      sfCtx.fillStyle = "#fff";

      for(const s of sfStars){
        s.y += s.sp * (dt/16);
        if (s.y > sfH + 2){
          s.y = -2;
          s.x = Math.random() * sfW;
        }
        s.a += s.tw * (dt/16);
        if (s.a > 0.85) s.tw *= -1;
        if (s.a < 0.12) s.tw *= -1;

        sfCtx.globalAlpha = s.a;
        sfCtx.beginPath();
        sfCtx.arc(s.x, s.y, s.r, 0, Math.PI*2);
        sfCtx.fill();
      }
      sfCtx.globalAlpha = 1;
      requestAnimationFrame(sfLoop);
    }
    requestAnimationFrame(sfLoop);

    // ========================= CONFETTI =========================
    const confettiCanvas = document.getElementById("confetti");
    const confettiCtx = confettiCanvas.getContext("2d", { alpha:true });

    function confettiResize(){
      const dpr = Math.max(1, window.devicePixelRatio || 1);
      confettiCanvas.width = Math.floor(window.innerWidth * dpr);
      confettiCanvas.height = Math.floor(window.innerHeight * dpr);
      confettiCanvas.style.width = window.innerWidth + "px";
      confettiCanvas.style.height = window.innerHeight + "px";
      confettiCtx.setTransform(dpr,0,0,dpr,0,0);
    }
    confettiResize();
    window.addEventListener("resize", confettiResize);

    function fireConfetti(durationMs = 2200){
      const w = window.innerWidth;
      const h = window.innerHeight;
      const start = performance.now();

      const pieces = Array.from({ length: 140 }, () => ({
        x: Math.random() * w,
        y: -20 - Math.random() * h * 0.2,
        vx: -1.2 + Math.random() * 2.4,
        vy: 3.2 + Math.random() * 5.6,
        r: 4 + Math.random() * 6,
        rot: Math.random() * Math.PI,
        vr: (-0.2 + Math.random() * 0.4),
        c: (["#ffd36b", "#00aaff", "#ff3c3c", "#ffffff"][(Math.random()*4)|0]),
        life: 0.85 + Math.random() * 0.6
      }));

      function frame(t){
        const p = Math.min(1, (t - start) / durationMs);
        confettiCtx.clearRect(0,0,w,h);

        for (const q of pieces){
          q.x += q.vx;
          q.y += q.vy;
          q.vy += 0.03;
          q.rot += q.vr;

          if (q.x < -30) q.x = w + 30;
          if (q.x > w + 30) q.x = -30;

          const fade = p < 0.75 ? 1 : (1 - (p - 0.75) / 0.25);
          confettiCtx.globalAlpha = fade * q.life;

          confettiCtx.save();
          confettiCtx.translate(q.x, q.y);
          confettiCtx.rotate(q.rot);
          confettiCtx.fillStyle = q.c;
          confettiCtx.fillRect(-q.r, -q.r*0.6, q.r*2, q.r*1.2);
          confettiCtx.restore();
        }

        if (p < 1) requestAnimationFrame(frame);
        else confettiCtx.clearRect(0,0,w,h);
      }
      requestAnimationFrame(frame);
    }

    // ========================= DUEL FX =========================
    function showDuelFx(ms=560){
      duelFx.classList.add("show");
      setTimeout(() => duelFx.classList.remove("show"), ms);
    }

    // ========================= SECRET EGG (5 taps) =========================
    (function birthdayEgg(){
      let taps = 0;
      let timer = null;

      function showBirthday(){
        secretMsg.classList.add("show");
        fireConfetti(2600);
        vibe([30, 40, 30]);
        setTimeout(() => secretMsg.classList.remove("show"), 2500);
      }

      secretTitle.addEventListener("click", () => {
        taps++;
        clearTimeout(timer);
        timer = setTimeout(() => (taps = 0), 900);
        if (taps >= 5){
          taps = 0;
          showBirthday();
        }
      });
    })();

    // ========================= FLOW: START -> CRAWL -> MENU =========================
    async function beginExperience(){
      // Mobile-safe: intro must be started from this tap
      vibe(20);

      // Hide start overlay instantly
      startOverlay.style.display = "none";

      // Show crawl + start intro music
      crawlScreen.style.display = "flex";
      const ok = await playFromUserTap(intro, true);

      // If intro fails, open the audio file so the user can play it manually
      if (!ok){
        window.open(INTRO_URL, "_blank", "noopener");
      }

      // Start crawl animation
      crawlText.classList.add("run");

      // When crawl is done: IMMEDIATE menu
      setTimeout(() => {
        crawlScreen.style.display = "none";
        mainCard.style.display = "flex";
        // next tick so transitions apply
        requestAnimationFrame(() => mainCard.classList.add("show"));
      }, CRAWL_MS - 120); // super snappy: almost no gap
    }

    startBtn.addEventListener("click", beginExperience, { once:true });

    // ========================= BUTTONS =========================
    document.getElementById("igniteBtn").addEventListener("click", async () => {
      vibe([40, 20, 40]);
      showDuelFx();
      saber.currentTime = 0;
      // play saber - if blocked, open file
      const ok = await playFromUserTap(saber, true);
      if (!ok) window.open(SABER_URL, "_blank", "noopener");
    });

    document.getElementById("musicBtn").addEventListener("click", async () => {
      vibe(25);
      showDuelFx();
      // force restart theme every tap
      theme.currentTime = 0;
      const ok = await playFromUserTap(theme, true);
      if (!ok) window.open(THEME_URL, "_blank", "noopener");
    });

    document.getElementById("stopBtn").addEventListener("click", () => {
      vibe(15);
      theme.pause();
      theme.currentTime = 0;
    });

    document.getElementById("rsvpBtn").addEventListener("click", () => {
      vibe([20, 40, 20]);
      warpOverlay.classList.add("show");

      // fast countdown
      const steps = ["Jumping in 3‚Ä¶","Jumping in 2‚Ä¶","Jumping in 1‚Ä¶","Jump!"];
      let i = 0;
      warpCountdown.textContent = steps[i];

      const tick = setInterval(() => {
        i++;
        if (i >= steps.length){
          clearInterval(tick);
          window.location.href = RSVP_FORM;
          return;
        }
        warpCountdown.textContent = steps[i];
      }, 220); // snappy

      // safety: navigate regardless
      setTimeout(() => window.location.href = RSVP_FORM, 900);
    });
  </script>
</body>
</html>
